#!/usr/bin/awk -f

function D(i,r,a,c){for(p in Q)for(c in i){$0=c;g(a,Q[p]*i[$0],r+1)}c&&D(a,!r)}
function g(a,m,e) {($(e+2)+=$e=($e+p+1)%10+1)<21?a[$0]+=m:e~1?t+=m:u+=m}d(a,$5)
function o(f)    {x=(2+r+++r+++r+++f)%10+1}a{U[a FS $5]=1;D(U)}{a=$5}$0=r*s[!q]
function d(i,e) {i&&(1e3>s[q=!q]+=o(i)x)&&d(e,x)}split(1367631,Q,z)&&$0=u>t?u:t
