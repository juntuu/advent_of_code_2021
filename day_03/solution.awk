#!/usr/bin/awk -f

bit function f(p){n=0;for(s in p){for(j=split(s,q,z);j--;)X[j]+=2*q[j+1];n++}}
odd function r(p){for(x=0;f(p)n>1;x++){for(i in p)if((i~"^.{"x"}"(X[x]<n))~!k)
delete p[i];delete X}for(i in p)for(f(o);i;k=sub(/./,z,i))n=n*2+(i~/^1/)}A[$0]
END{for(f(A);y=X[+i++];g=g*2+!y)e=e*2+(y=y<n);print g*e RS r(A)n*(r(B)n)}B[$0]
